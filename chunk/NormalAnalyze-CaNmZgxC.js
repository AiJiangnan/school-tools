import{s as M}from"./node-xlsx-DLXZ95PR.js";import{d as Q,e as K,f as X,g as Y,h as Z,B as ee,S as te,T as ae,i as ne,j as oe}from"./ant-design-vue-BzNP172m.js";import{r as i,P as S,U as N,c as r,R as l,V as se,F as D,u as d,E as B,W as ce,a0 as q,a1 as ue,Q as G}from"./@vue-vfydSGcF.js";import"./xlsx-BSlZAFvl.js";import"./@babel-D6Xak2o6.js";import"./@ant-design-DvXUoR2B.js";import"./@ctrl-DOFZgDuz.js";import"./dayjs-DfUUTG6R.js";import"./copy-to-clipboard-gvHgSpPc.js";import"./toggle-selection-BHUZwh74.js";import"./lodash-es-Bd9XdmsI.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./throttle-debounce-CUWDS_la.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./vue-types-C5fUfLeo.js";function re(){const O={年级:"grade",班级:"class",学生姓名:"name",语文:"chinese",数学:"math",英语:"english",两科总分:"total"},f=i(!1),R=i([]),b=i([]),P=i([]),v=i([{title:"班级",dataIndex:"class"},{title:"人数",dataIndex:"count"},{title:"平均分",dataIndex:"average"},{title:"及格人数",dataIndex:"passCount"},{title:"及格率",dataIndex:"passRate"},{title:"关爱平均分",dataIndex:"careScore"},{title:"特优人数",dataIndex:"topCount"},{title:"特优率",dataIndex:"topRate"}]),u=i([{key:"chinese",name:"语文",data:[]},{key:"math",name:"数学",data:[]},{key:"english",name:"英语",data:[]},{key:"two",name:"两科",data:[]},{key:"three",name:"三科",data:[]}]),h=i([{key:"chinese",name:"语文关爱生",data:[]},{key:"math",name:"数学关爱生",data:[]},{key:"english",name:"英语关爱生",data:[]},{key:"two",name:"两科关爱生",data:[]}]),w={types:[{description:"Excel",accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]}}],excludeAcceptAllOption:!0,multiple:!1};function y(){return window.showOpenFilePicker(w).then(([a])=>a.getFile()).then(a=>a.arrayBuffer()).then(a=>M.parse(a)).then(a=>z(a))}function z(a){R.value=a;const t=a[0].data[0];b.value=[{title:"序号",dataIndex:"no",customRender:({index:s})=>`${s+1}`},...t.map(s=>({title:s,dataIndex:O[s]})),{title:"两科总分",dataIndex:"total"}],P.value=a.map(j),f.value=!1}function j(a){const t={...a},s=a.data[0];return t.data.shift(),t.data=t.data.map(c=>{const e={};return c.forEach((o,T)=>e[O[s[T]]]=o),typeof e.chinese=="number"&&typeof e.math=="number"?e.total=e.chinese+e.math:e.total=e.chinese,c.push(e.total),e}),t}function p(){if(f.value){Q.warn("已经分析完成，请下载结果！");return}if(R.value.length===0){Q.warn("请先上传成绩文件！");return}const a=R.value;u.value.forEach(s=>s.data=[]);let t={name:"校平",count:0,score:{chinese:[],math:[],total:[]},chinese:{score:0,passCount:0,topCount:0,average:0,passRate:0,topRate:0},math:{score:0,passCount:0,topCount:0,average:0,passRate:0,topRate:0},english:{score:0,passCount:0,average:0,passRate:0},two:{score:0,passCount:0,topCount:0,average:0,passRate:0,topRate:0},three:{passCount:0,passRate:0}};for(let s=0;s<a.length;s++){const{data:c}=a[s];let e={name:"",count:0,chinese:{score:0,passCount:0,topCount:0,careScore:0,average:0,passRate:0,topRate:0,careStu:[]},math:{score:0,passCount:0,topCount:0,careScore:0,average:0,passRate:0,topRate:0,careStu:[]},english:{score:0,passCount:0,careScore:0,average:0,passRate:0,careStu:[]},two:{score:0,passCount:0,topCount:0,careScore:0,average:0,passRate:0,topRate:0,careStu:[]},three:{passCount:0,passRate:0}};for(let H=0;H<c.length;H++){let[A,E,I,x,g,m,k]=c[H];typeof x!="number"||typeof g!="number"||(k||(k=m,m=0),e.name=E,e.count++,e.chinese.score+=x,e.math.score+=g,e.english.score+=m,e.two.score+=k,x>=60&&(e.chinese.passCount++,x>=92.5&&e.chinese.topCount++,g>=60&&(e.two.passCount++,k>=185&&e.two.topCount++,m&&m>=60&&e.three.passCount++)),g>=60&&(e.math.passCount++,g>=92.5&&e.math.topCount++),m&&m>=60&&e.english.passCount++,e.chinese.careStu.push([A,E,I,x]),e.math.careStu.push([A,E,I,g]),m&&e.english.careStu.push([A,E,I,m]),e.two.careStu.push([A,E,I,k]),t.count++)}const o=C(e.chinese.careStu),T=C(e.math.careStu),L=C(e.english.careStu),W=C(e.two.careStu);t.two.score+=e.two.score,t.two.passCount+=e.two.passCount,t.two.topCount+=e.two.topCount,t.three.passCount+=e.three.passCount,t.chinese.score+=e.chinese.score,t.chinese.passCount+=e.chinese.passCount,t.chinese.topCount+=e.chinese.topCount,t.math.score+=e.math.score,t.math.passCount+=e.math.passCount,t.math.topCount+=e.math.topCount,t.english.score+=e.english.score,t.english.passCount+=e.english.passCount,e.two.average=n(e.two.score/e.count/2),e.two.passRate=n(e.two.passCount/e.count*100),e.two.topRate=n(e.two.topCount/e.count*100),e.two.careScore=W.careScore,e.three.passRate=n(e.three.passCount/e.count*100),e.chinese.average=n(e.chinese.score/e.count),e.chinese.passRate=n(e.chinese.passCount/e.count*100),e.chinese.topRate=n(e.chinese.topCount/e.count*100),e.chinese.careScore=o.careScore,e.math.average=n(e.math.score/e.count),e.math.passRate=n(e.math.passCount/e.count*100),e.math.topRate=n(e.math.topCount/e.count*100),e.math.careScore=T.careScore,e.english.average=n(e.english.score/e.count),e.english.passRate=n(e.english.passCount/e.count*100),e.english.careScore=L.careScore,u.value[0].data.push({class:e.name,count:e.count,...e.chinese}),u.value[1].data.push({class:e.name,count:e.count,...e.math}),u.value[2].data.push({class:e.name,count:e.count,...e.english}),u.value[3].data.push({class:e.name,count:e.count,...e.two}),u.value[4].data.push({class:e.name,count:e.count,...e.three}),h.value[0].data.push(...o.careStu),h.value[1].data.push(...T.careStu),h.value[2].data.push(...L.careStu),h.value[3].data.push(...W.careStu)}t.two.average=n(t.two.score/t.count/2),t.two.passRate=n(t.two.passCount/t.count*100),t.two.careRate=n((1-t.two.careCount/t.count)*100),t.two.topRate=n(t.two.topCount/t.count*100),t.three.passRate=n(t.three.passCount/t.count*100),t.chinese.average=n(t.chinese.score/t.count),t.chinese.passRate=n(t.chinese.passCount/t.count*100),t.chinese.careRate=n((1-t.chinese.careCount/t.count)*100),t.chinese.topRate=n(t.chinese.topCount/t.count*100),t.math.average=n(t.math.score/t.count),t.math.passRate=n(t.math.passCount/t.count*100),t.math.careRate=n((1-t.math.careCount/t.count)*100),t.math.topRate=n(t.math.topCount/t.count*100),t.english.average=n(t.english.score/t.count),t.english.passRate=n(t.english.passCount/t.count*100),u.value[0].data.unshift({class:t.name,count:t.count,...t.chinese}),u.value[1].data.unshift({class:t.name,count:t.count,...t.math}),u.value[2].data.unshift({class:t.name,count:t.count,...t.english}),u.value[3].data.unshift({class:t.name,count:t.count,...t.two}),u.value[4].data.unshift({class:t.name,count:t.count,...t.three}),f.value=!0}function C(a){if(a.length===0)return{careStu:[],careScore:0};a.sort((c,e)=>c[3]-e[3]);const t=a.slice(0,Math.round(a.length*.2));let s=0;for(let c=0;c<t.length;c++)s+=t[c][3];return{careStu:t,careScore:n(s/t.length)}}function _(){const a=[];u.value.forEach(c=>{const e=[["班级","人数","平均分","及格人数","及格率","关爱平均分","特优人数","特优率"]];c.data.forEach(o=>e.push([o.class,o.count,o.average,o.passCount,o.passRate,o.careScore,o.topCount,o.topRate])),a.push({name:c.name,data:e})});const t=["语文","数学","英语","两科"];h.value.forEach((c,e)=>{const o=["年级","班级","姓名",t[e]];a.push({name:t[e]+"关爱生",data:[o,...c.data]})});const s=M.build(a);F(new File([s],"result.xlsx",{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}))}function n(a){return Math.round(a*100)/100}function F(a){const t=window.document.createElement("a");t.href=window.URL.createObjectURL(a),t.download=a.name,document.body.appendChild(t),t.click(),document.body.removeChild(t)}return{done:f,tableHead:b,tableData:P,resultHead:v,resultData:u,upload:y,analyse:p,download:_}}const le={style:{width:"600px"}},pe={key:0,style:{width:"600px"}},Ae={__name:"NormalAnalyze",setup(J){const{done:V,tableHead:U,tableData:$,resultHead:O,resultData:f,upload:R,analyse:b,download:P}=re(),v=i(!1),u=i(null),h=i(null),w=i(null),y=i(0),z=[{title:"导入",description:"上传年级的成绩Excel文件。",target:()=>u.value&&u.value.$el},{title:"分析",description:"分析各个班级和全校的成绩指标。",target:()=>h.value&&h.value.$el},{title:"下载",description:"下载分析结果Excel文件。",target:()=>w.value&&w.value.$el}];return(j,p)=>{const C=Y,_=Z,n=ee,F=te,a=ne,t=oe,s=ae,c=K,e=X;return S(),N(D,null,[r(c,{gutter:[0,16]},{default:l(()=>[r(_,{span:24},{default:l(()=>[r(C,{banner:"",closable:"",message:"注意：本工具无后台服务，不会上传任何信息和文件，请放心使用。最近更新：新增关爱平均分"})]),_:1}),r(_,{span:24},{default:l(()=>[r(F,{wrap:""},{default:l(()=>[r(n,{ref_key:"ref1",ref:u,type:"primary",onClick:p[0]||(p[0]=()=>d(R)())},{default:l(()=>[B("1. 导入")]),_:1},512),r(n,{ref_key:"ref2",ref:h,type:"primary",onClick:p[1]||(p[1]=()=>d(b)())},{default:l(()=>[B("2. 分析")]),_:1},512),r(n,{ref_key:"ref3",ref:w,type:"primary",onClick:p[2]||(p[2]=()=>d(P)())},{default:l(()=>[B("3. 下载")]),_:1},512),r(n,{type:"link",onClick:p[3]||(p[3]=()=>{v.value=!0,y.value=0})},{default:l(()=>[B("帮助")]),_:1})]),_:1})]),_:1}),r(_,{span:12},{default:l(()=>[ce("div",le,[r(s,null,{default:l(()=>[(S(!0),N(D,null,q(d($),o=>(S(),G(t,{key:o.name,tab:o.name},{default:l(()=>[r(a,{size:"small",pagination:!1,columns:d(U),dataSource:o.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])]),_:1}),r(_,{span:12},{default:l(()=>[d(V)?(S(),N("div",pe,[r(s,null,{default:l(()=>[(S(!0),N(D,null,q(d(f),o=>(S(),G(t,{key:o.key,tab:o.name},{default:l(()=>[r(a,{size:"small",pagination:!1,columns:d(O),dataSource:o.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])):ue("",!0)]),_:1})]),_:1}),r(e,se({current:y.value,"onUpdate:current":p[4]||(p[4]=o=>y.value=o)},{open:v.value,steps:z,onClose:()=>v.value=!1}),null,16,["current"])],64)}}};export{Ae as default};
