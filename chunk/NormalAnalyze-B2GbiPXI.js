import{r as G,u as v,w as Q}from"./xlsx-DZ7xr1Uj.js";import{d as H,e as U,f as q,g as J,h as K,i as Y,B as Z,S as tt,T as et,j as at,k as nt,P as st,I as ot,m as lt,n as ut,o as rt}from"./ant-design-vue-DPrabZFW.js";import{r as y,Q as R,U as z,c as n,S as s,u as g,F,G as p,W as ct,a0 as M,R as V}from"./@vue-BC2K3yCp.js";import"./@babel-BiFW4_mA.js";import"./@ant-design-BZl7eYef.js";import"./@ctrl-DOFZgDuz.js";import"./dayjs-DfUUTG6R.js";import"./copy-to-clipboard-gvHgSpPc.js";import"./toggle-selection-BHUZwh74.js";import"./lodash-es-BdFaghAI.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./throttle-debounce-CUWDS_la.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./vue-types-C5fUfLeo.js";const[T,L,pt,it]=[60,92.5,92.5*2,.2],O=["chinese","math","english","two","three"];function k(d){return Math.round(d*100)/100}class W{constructor(a){this.name=a||"",this.count=0,this.chinese=new P,this.math=new P,this.english=new P,this.two=new P,this.three=new P}plusCount(){this.count++}plus(a){O.forEach(r=>{this[r].plusScore(a[r].score),this[r].plusPassCount(a[r].passCount),this[r].plusTopCount(a[r].topCount)})}calc(){O.forEach(a=>{this[a].calc(this.count)}),this.two.average=k(this.two.average/2),this.three.average=k(this.three.average/3)}}class P{constructor(){this.score=0,this.passCount=0,this.topCount=0,this.careScore=0,this.average=0,this.passRate=0,this.topRate=0,this.careStu=[]}plusScore(a){this.score+=a}plusPassCount(a){this.passCount+=a===void 0?1:a}plusTopCount(a){this.topCount+=a===void 0?1:a}pushCareStu(a){this.careStu.push(a)}calc(a){this.calcCareScore(),this.average=k(this.score/a),this.passRate=k(this.passCount/a*100),this.topRate=k(this.topCount/a*100)}calcCareScore(){if(this.careStu.length===0)return;this.careStu=this.careStu.sort((r,w)=>r[3]-w[3]).slice(0,Math.round(this.careStu.length*it));let a=0;for(let r=0;r<this.careStu.length;r++)a+=this.careStu[r][3];this.careScore=k(a/this.careStu.length)}}function dt(){const d=y(!1),a=y([]),r=y([{title:"序号",dataIndex:"no",customRender:({index:t})=>`${t+1}`},{title:"年级",dataIndex:"grade"},{title:"班级",dataIndex:"class"},{title:"学生姓名",dataIndex:"name"},{title:"语文",dataIndex:"chinese",sorter:(t,o)=>t.chinese-o.chinese},{title:"数学",dataIndex:"math",sorter:(t,o)=>t.math-o.math},{title:"英语",dataIndex:"english",sorter:(t,o)=>t.english-o.english},{title:"两科总分",dataIndex:"two",sorter:(t,o)=>t.two-o.two}]),w=y([{title:"班级",dataIndex:"class"},{title:"人数",dataIndex:"count"},{title:"平均分",dataIndex:"average"},{title:"及格人数",dataIndex:"passCount"},{title:"及格率",dataIndex:"passRate"},{title:"关爱平均分",dataIndex:"careScore"},{title:"特优人数",dataIndex:"topCount"},{title:"特优率",dataIndex:"topRate"}]),C=y([{key:"chinese",name:"语文",data:[]},{key:"math",name:"数学",data:[]},{key:"english",name:"英语",data:[]},{key:"two",name:"两科",data:[]},{key:"three",name:"三科",data:[]}]),b=y([{key:"chinese",name:"语文关爱生",data:[]},{key:"math",name:"数学关爱生",data:[]},{key:"english",name:"英语关爱生",data:[]},{key:"two",name:"两科关爱生",data:[]}]),B={types:[{description:"Excel",accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]}}],excludeAcceptAllOption:!0,multiple:!1};function N(){return window.showOpenFilePicker(B).then(([t])=>t.getFile()).then(t=>t.arrayBuffer()).then(t=>G(t)).then(t=>j(t))}function j(t){a.value=t.SheetNames.map(o=>{const u=v.sheet_to_json(t.Sheets[o]).map(({年级:e,班级:h,学生姓名:m,语文:i,数学:_,英语:f})=>{const c=typeof i=="number"&&typeof _=="number"?i+_:i;return{grade:e,class:h,name:m,chinese:i,math:_,english:f,two:c}});return{sheet:o,data:u}}),d.value=!1}function I(){if(d.value){H.warn("已经分析完成，请下载结果！");return}if(a.value.length===0){H.warn("请先上传成绩文件！");return}C.value.forEach(l=>l.data=[]),b.value.forEach(l=>l.data=[]);const t=new W("校平"),o=a.value;for(let l=0;l<o.length;l++){const{data:u}=o[l],e=new W;for(let h=0;h<u.length;h++){let{class:m,name:i,chinese:_,math:f,english:c,two:x}=u[h];c=c||0,!(typeof _!="number"||typeof f!="number")&&(e.name=m,e.plusCount(),e.chinese.plusScore(_),e.math.plusScore(f),e.english.plusScore(c),e.two.plusScore(x),_>=T&&(e.chinese.plusPassCount(),_>=L&&e.chinese.plusTopCount(),f>=T&&(e.two.plusPassCount(),x>=pt&&e.two.plusTopCount(),c&&c>=T&&e.three.plusPassCount())),f>=T&&(e.math.plusPassCount(),f>=L&&e.math.plusTopCount()),c&&c>=T&&e.english.plusPassCount(),e.chinese.pushCareStu([t,e,i,_]),e.math.pushCareStu([t,e,i,f]),c&&e.english.pushCareStu([t,e,i,c]),e.two.pushCareStu([t,e,i,x]),t.plusCount())}t.plus(e),e.calc(),O.forEach((h,m)=>{C.value[m].data.push({class:e.name,count:e.count,...e[h]}),m<4&&b.value[m].data.push(...e[h].careStu)})}t.calc(),O.forEach((l,u)=>{C.value[u].data.unshift({class:t.name,count:t.count,...t[l]})}),d.value=!0}function D(){if(console.log(d.value),!d.value){H.warning("请先分析成绩！");return}const t=v.book_new();C.value.forEach(l=>{const u=[w.value.map(e=>e.title)];l.data.forEach(e=>u.push([e.class,e.count,e.average,e.passCount,e.passRate,e.careScore,e.topCount,e.topRate])),v.book_append_sheet(t,v.aoa_to_sheet(u),l.name)});const o=["语文","数学","英语","两科"];b.value.forEach((l,u)=>{const e=[["年级","班级","姓名",o[u]],...l.data];v.book_append_sheet(t,v.aoa_to_sheet(e),`${o[u]}关爱生`)}),Q(t,"result.xlsx")}return{done:d,tableHead:r,excelData:a,resultHead:w,resultData:C,upload:N,analyse:I,download:D}}const ht={style:{width:"800px"}},Nt={__name:"NormalAnalyze",setup(d){const{done:a,tableHead:r,excelData:w,resultHead:C,resultData:b,upload:B,analyse:N,download:j}=dt(),I=y(!1);return(D,t)=>{const o=K,l=Y,u=Z,e=tt,h=ut,m=rt,i=et,_=U,f=q,c=at,x=nt,E=st,A=ot,X=lt,$=J;return R(),z(F,null,[n(_,{gutter:[0,16]},{default:s(()=>[n(l,{span:24},{default:s(()=>[n(o,{banner:"",closable:"",message:"注意：本工具无后台服务，不会上传任何信息和文件，请放心使用。最近更新：新增关爱平均分"})]),_:1}),n(l,{span:24},{default:s(()=>[n(e,{wrap:""},{default:s(()=>[n(u,{ref:"ref1",type:"primary",onClick:t[0]||(t[0]=()=>g(B)())},{default:s(()=>[p("1. 导入")]),_:1},512),n(u,{ref:"ref2",type:"primary",onClick:t[1]||(t[1]=()=>g(N)())},{default:s(()=>[p("2. 分析")]),_:1},512),n(u,{type:"link",onClick:t[2]||(t[2]=()=>{I.value=!0})},{default:s(()=>[p("帮助")]),_:1})]),_:1})]),_:1}),n(l,{span:24},{default:s(()=>[ct("div",ht,[n(i,null,{default:s(()=>[(R(!0),z(F,null,M(g(w),S=>(R(),V(m,{key:S.sheet,tab:S.sheet},{default:s(()=>[n(h,{size:"small",pagination:!1,columns:g(r),dataSource:S.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])]),_:1})]),_:1}),n(f,{open:g(a),size:"large",title:"成绩分析结果",onClose:t[4]||(t[4]=()=>a.value=!1)},{extra:s(()=>[n(u,{ref:"ref3",type:"primary",onClick:t[3]||(t[3]=()=>g(j)())},{default:s(()=>[p("3. 下载")]),_:1},512)]),default:s(()=>[n(o,{banner:"",closable:"",type:"success",message:"注意：更多详细分析结果点击下载。"}),n(i,null,{default:s(()=>[(R(!0),z(F,null,M(g(b),S=>(R(),V(m,{key:S.key,tab:S.name},{default:s(()=>[n(h,{size:"small",pagination:!1,columns:g(C),dataSource:S.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})]),_:1},8,["open"]),n($,{open:I.value,width:"800px",footer:null,onCancel:t[5]||(t[5]=()=>I.value=!1)},{default:s(()=>[n(X,null,{default:s(()=>[n(c,{level:2},{default:s(()=>[p("帮助文档")]),_:1}),n(c,{level:3},{default:s(()=>[p("1. 导入")]),_:1}),n(E,null,{default:s(()=>[p(" 第一步：点击导入按钮，导入各班级成绩的Excel文档，文件格式必须为"),n(x,{strong:"",type:"danger"},{default:s(()=>[p(" .xlsx ")]),_:1}),p("，数据表格必须包含列： ")]),_:1}),n(E,null,{default:s(()=>[n(x,{strong:"",type:"danger"},{default:s(()=>[p("年级、班级、学生姓名、语文、数学、英语（可选）")]),_:1})]),_:1}),n(E,null,{default:s(()=>[p(" 导入成绩后，可以通过切换标签页，查看各个班级的各科成绩情况，并且支持对各科进行排序。 ")]),_:1}),n(A,{src:"/1.png"}),n(c,{level:3},{default:s(()=>[p("2. 分析")]),_:1}),n(E,null,{default:s(()=>[p(" 第二步：点击分析按钮，分析班级各个指标，结果弹窗展示，切换标签页面查看每个班级的情况。 ")]),_:1}),n(A,{src:"/2.png"}),n(c,{level:3},{default:s(()=>[p("3. 下载")]),_:1}),n(E,null,{default:s(()=>[p(" 第三步：点击下载按钮，下载各个班级详情的分析结果，包含各个班级的各个指标，以及关爱学生名单。 ")]),_:1}),n(A,{src:"/3.png"})]),_:1})]),_:1},8,["open"])],64)}}};export{Nt as default};
