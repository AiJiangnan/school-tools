import{s as q}from"./node-xlsx-DLXZ95PR.js";import{d as G,e as tt,f as et,g as at,h as nt,B as ot,S as st,T as ct,i as ut,j as rt}from"./ant-design-vue-BzNP172m.js";import{r as h,P as O,U as V,c as r,R as i,V as lt,F as L,u as _,E as j,W as J,a0 as K,Z as W,a1 as pt,Q as X}from"./@vue-vfydSGcF.js";import"./xlsx-BSlZAFvl.js";import"./@babel-D6Xak2o6.js";import"./@ant-design-DvXUoR2B.js";import"./@ctrl-DOFZgDuz.js";import"./dayjs-DfUUTG6R.js";import"./copy-to-clipboard-gvHgSpPc.js";import"./toggle-selection-BHUZwh74.js";import"./lodash-es-Bd9XdmsI.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./throttle-debounce-CUWDS_la.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./vue-types-C5fUfLeo.js";function it(){const B={年级:"grade",班级:"class",学生姓名:"name",语文:"chinese",数学:"math",英语:"english",两科总分:"total"},E=h(!1),P=h([]),z=h([]),D=h([]),H=h({chinese:0,math:0,total:0}),T=h([{title:"班级",dataIndex:"class"},{title:"人数",dataIndex:"count"},{title:"平均分",dataIndex:"average"},{title:"及格人数",dataIndex:"passCount"},{title:"及格率",dataIndex:"passRate"},{title:"关爱人数",dataIndex:"careCount"},{title:"关爱率",dataIndex:"careRate"},{title:"特优人数",dataIndex:"topCount"},{title:"特优率",dataIndex:"topRate"}]),u=h([{key:"chinese",name:"语文",data:[]},{key:"math",name:"数学",data:[]},{key:"english",name:"英语",data:[]},{key:"two",name:"两科",data:[]},{key:"three",name:"三科",data:[]}]),f=h([{key:"score",name:"关爱线",data:[]},{key:"chinese",name:"语文关爱生",data:[]},{key:"math",name:"数学关爱生",data:[]},{key:"english",name:"英语关爱生",data:[]},{key:"two",name:"两科关爱生",data:[]}]),A={types:[{description:"Excel",accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]}}],excludeAcceptAllOption:!0,multiple:!1};function I(){return window.showOpenFilePicker(A).then(([n])=>n.getFile()).then(n=>n.arrayBuffer()).then(n=>q.parse(n)).then(n=>U(n))}function U(n){P.value=n;const o=n[0].data[0];z.value=[{title:"序号",dataIndex:"no",customRender:({index:l})=>`${l+1}`},...o.map(l=>({title:l,dataIndex:B[l]})),{title:"两科总分",dataIndex:"total"}],D.value=n.map(Z),E.value=!1}function Z(n){const o={...n},l=n.data[0];return o.data.shift(),o.data=o.data.map(p=>{const t={};return p.forEach((s,c)=>t[B[l[c]]]=s),typeof t.chinese=="number"&&typeof t.math=="number"?t.total=t.chinese+t.math:t.total=t.chinese,p.push(t.total),t}),o}function m(){if(E.value){G.warn("已经分析完成，请下载结果！");return}if(P.value.length===0){G.warn("请先上传成绩文件！");return}const n=P.value;u.value.forEach(d=>d.data=[]);let[o,l,p]=[[],[],[]],t={name:"校平",count:0,care:{chinese:0,math:0,total:0},score:{chinese:[],math:[],total:[]},chinese:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0},math:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0},english:{score:0,passCount:0,average:0,passRate:0},two:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0},three:{passCount:0,passRate:0}};for(let d=0;d<n.length;d++){const{data:w}=n[d];for(let e=0;e<w.length;e++){let[N,k,S,R,y,g,C]=w[e];typeof R!="number"||typeof y!="number"||(C||(C=g),o.push(R),l.push(y),p.push(C),t.count++)}}const s=(d,w)=>w-d,c=parseInt(.8*t.count);t.care.chinese=o.sort(s)[c],t.care.math=l.sort(s)[c],t.care.total=p.sort(s)[c],H.value=t.care,f.value[0].data.push({...t.care});for(let d=0;d<n.length;d++){const{data:w}=n[d];let e={name:"",count:0,chinese:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0,careStu:[]},math:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0,careStu:[]},english:{score:0,passCount:0,average:0,passRate:0,careStu:[]},two:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0,careStu:[]},three:{passCount:0,passRate:0}};for(let k=0;k<w.length;k++){let[S,R,y,g,C,v,b]=w[k];typeof g!="number"||typeof C!="number"||(b||(b=v,v=0),e.name=R,e.count++,e.chinese.score+=g,e.math.score+=C,e.english.score+=v,e.two.score+=b,g>=60&&(e.chinese.passCount++,g>=92.5&&e.chinese.topCount++,C>=60&&(e.two.passCount++,b>=185&&e.two.topCount++,v&&v>=60&&e.three.passCount++)),C>=60&&(e.math.passCount++,C>=92.5&&e.math.topCount++),v&&(v>=60?e.english.passCount++:e.english.careStu.push([S,R,y,v])),g<=t.care.chinese&&(e.chinese.careCount++,e.chinese.careStu.push([S,R,y,g])),C<=t.care.math&&(e.math.careCount++,e.math.careStu.push([S,R,y,C])),b<=t.care.total&&(e.two.careCount++,e.two.careStu.push([S,R,y,b])))}t.two.score+=e.two.score,t.two.passCount+=e.two.passCount,t.two.topCount+=e.two.topCount,t.two.careCount+=e.two.careCount,t.three.passCount+=e.three.passCount,t.chinese.score+=e.chinese.score,t.chinese.passCount+=e.chinese.passCount,t.chinese.topCount+=e.chinese.topCount,t.chinese.careCount+=e.chinese.careCount,t.math.score+=e.math.score,t.math.passCount+=e.math.passCount,t.math.topCount+=e.math.topCount,t.math.careCount+=e.math.careCount,t.english.score+=e.english.score,t.english.passCount+=e.english.passCount,e.two.average=a(e.two.score/e.count/2),e.two.passRate=a(e.two.passCount/e.count*100),e.two.careRate=a((1-e.two.careCount/e.count)*100),e.two.topRate=a(e.two.topCount/e.count*100),e.three.passRate=a(e.three.passCount/e.count*100),e.chinese.average=a(e.chinese.score/e.count),e.chinese.passRate=a(e.chinese.passCount/e.count*100),e.chinese.careRate=a((1-e.chinese.careCount/e.count)*100),e.chinese.topRate=a(e.chinese.topCount/e.count*100),e.math.average=a(e.math.score/e.count),e.math.passRate=a(e.math.passCount/e.count*100),e.math.careRate=a((1-e.math.careCount/e.count)*100),e.math.topRate=a(e.math.topCount/e.count*100),e.english.average=a(e.english.score/e.count),e.english.passRate=a(e.english.passCount/e.count*100),u.value[0].data.push({class:e.name,count:e.count,...e.chinese}),u.value[1].data.push({class:e.name,count:e.count,...e.math}),u.value[2].data.push({class:e.name,count:e.count,...e.english}),u.value[3].data.push({class:e.name,count:e.count,...e.two}),u.value[4].data.push({class:e.name,count:e.count,...e.three});const N=(k,S)=>S[3]-k[3];f.value[1].data.push(...e.chinese.careStu.sort(N)),f.value[2].data.push(...e.math.careStu.sort(N)),f.value[3].data.push(...e.english.careStu.sort(N)),f.value[4].data.push(...e.two.careStu.sort(N))}t.two.average=a(t.two.score/t.count/2),t.two.passRate=a(t.two.passCount/t.count*100),t.two.careRate=a((1-t.two.careCount/t.count)*100),t.two.topRate=a(t.two.topCount/t.count*100),t.three.passRate=a(t.three.passCount/t.count*100),t.chinese.average=a(t.chinese.score/t.count),t.chinese.passRate=a(t.chinese.passCount/t.count*100),t.chinese.careRate=a((1-t.chinese.careCount/t.count)*100),t.chinese.topRate=a(t.chinese.topCount/t.count*100),t.math.average=a(t.math.score/t.count),t.math.passRate=a(t.math.passCount/t.count*100),t.math.careRate=a((1-t.math.careCount/t.count)*100),t.math.topRate=a(t.math.topCount/t.count*100),t.english.average=a(t.english.score/t.count),t.english.passRate=a(t.english.passCount/t.count*100),u.value[0].data.unshift({class:t.name,count:t.count,...t.chinese}),u.value[1].data.unshift({class:t.name,count:t.count,...t.math}),u.value[2].data.unshift({class:t.name,count:t.count,...t.english}),u.value[3].data.unshift({class:t.name,count:t.count,...t.two}),u.value[4].data.unshift({class:t.name,count:t.count,...t.three}),E.value=!0}function $(){const n=[];u.value.forEach(p=>{const t=[["班级","人数","平均分","及格人数","及格率","关爱人数","关爱率","特优人数","特优率"]];p.data.forEach(s=>t.push([s.class,s.count,s.average,s.passCount,s.passRate,s.careCount,s.careRate,s.topCount,s.topRate])),n.push({name:p.name,data:t})});const o=["语文","数学","英语","两科"];f.value.forEach((p,t)=>{if(t===0){const s=[o];p.data.forEach(c=>s.push([c.chinese,c.math,60,c.total])),n.push({name:"关爱线",data:s})}else{const s=["年级","班级","姓名",o[t-1]];n.push({name:o[t-1]+"关爱生",data:[s,...p.data]})}});const l=q.build(n);x(new File([l],"result.xlsx",{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}))}function a(n){return Math.round(n*100)/100}function x(n){const o=window.document.createElement("a");o.href=window.URL.createObjectURL(n),o.download=n.name,document.body.appendChild(o),o.click(),document.body.removeChild(o)}return{done:E,careScore:H,tableHead:z,tableData:D,resultHead:T,resultData:u,upload:I,analyse:m,download:$}}const ht={style:{width:"600px"}},mt={key:0,style:{width:"600px"}},Ft={__name:"NormalAnalyze",setup(Y){const{done:M,careScore:F,tableHead:Q,tableData:B,resultHead:E,resultData:P,upload:z,analyse:D,download:H}=it(),T=h(!1),u=h(null),f=h(null),A=h(null),I=h(0),U=[{title:"导入",description:"上传年级的成绩Excel文件。",target:()=>u.value&&u.value.$el},{title:"分析",description:"分析各个班级和全校的成绩指标。",target:()=>f.value&&f.value.$el},{title:"下载",description:"下载分析结果Excel文件。",target:()=>A.value&&A.value.$el}];return(Z,m)=>{const $=at,a=nt,x=ot,n=st,o=ut,l=rt,p=ct,t=tt,s=et;return O(),V(L,null,[r(t,{gutter:[0,16]},{default:i(()=>[r(a,{span:24},{default:i(()=>[r($,{banner:"",closable:"",message:"注意：本工具无后台服务，不会上传任何信息和文件，请放心使用。"})]),_:1}),r(a,{span:24},{default:i(()=>[r(n,{wrap:""},{default:i(()=>[r(x,{ref_key:"ref1",ref:u,type:"primary",onClick:m[0]||(m[0]=()=>_(z)())},{default:i(()=>[j("1. 导入")]),_:1},512),r(x,{ref_key:"ref2",ref:f,type:"primary",onClick:m[1]||(m[1]=()=>_(D)())},{default:i(()=>[j("2. 分析")]),_:1},512),r(x,{ref_key:"ref3",ref:A,type:"primary",onClick:m[2]||(m[2]=()=>_(H)())},{default:i(()=>[j("3. 下载")]),_:1},512),r(x,{type:"link",onClick:m[3]||(m[3]=()=>{T.value=!0,I.value=0})},{default:i(()=>[j("帮助")]),_:1})]),_:1})]),_:1}),r(a,{span:12},{default:i(()=>[J("div",ht,[r(p,null,{default:i(()=>[(O(!0),V(L,null,K(_(B),c=>(O(),X(l,{key:c.name,tab:c.name},{default:i(()=>[r(o,{size:"small",pagination:!1,columns:_(Q),dataSource:c.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])]),_:1}),r(a,{span:12},{default:i(()=>[_(M)?(O(),V("div",mt,[J("div",null,"关爱分数：语文："+W(_(F).chinese)+" 数学："+W(_(F).math)+" 两科："+W(_(F).total),1),r(p,null,{default:i(()=>[(O(!0),V(L,null,K(_(P),c=>(O(),X(l,{key:c.key,tab:c.name},{default:i(()=>[r(o,{size:"small",pagination:!1,columns:_(E),dataSource:c.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])):pt("",!0)]),_:1})]),_:1}),r(s,lt({current:I.value,"onUpdate:current":m[4]||(m[4]=c=>I.value=c)},{open:T.value,steps:U,onClose:()=>T.value=!1}),null,16,["current"])],64)}}};export{Ft as default};
