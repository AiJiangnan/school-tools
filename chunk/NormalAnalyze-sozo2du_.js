import{s as M}from"./node-xlsx-DLXZ95PR.js";import{r as h,P as x,U as H,c,R as l,V as J,F as U,u as d,E as B,W as V,a0 as Q,Z as $,Q as Z}from"./@vue-CnPkYVV3.js";import{d as K,e as X,f as Y,g as tt,B as et,S as at,T as nt,h as ot,i as st}from"./ant-design-vue-B2-SqXRJ.js";import"./xlsx-BSlZAFvl.js";import"./@babel-D6Xak2o6.js";import"./@ant-design-CZ1nH3PE.js";import"./@ctrl-DOFZgDuz.js";import"./dayjs-CXLFLwF_.js";import"./lodash-es-By6oLbc8.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./throttle-debounce-CUWDS_la.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./vue-types-C5fUfLeo.js";function ct(){const b={年级:"grade",班级:"class",学生姓名:"name",语文:"chinese",数学:"math",英语:"english",两科总分:"total"},O=h([]),k=h([]),P=h([]),T=h({chinese:0,math:0,total:0}),v=h([{title:"班级",dataIndex:"class"},{title:"人数",dataIndex:"count"},{title:"平均分",dataIndex:"average"},{title:"及格人数",dataIndex:"passCount"},{title:"及格率",dataIndex:"passRate"},{title:"关爱人数",dataIndex:"careCount"},{title:"关爱率",dataIndex:"careRate"},{title:"特优人数",dataIndex:"topCount"},{title:"特优率",dataIndex:"topRate"}]),s=h([{key:"chinese",name:"语文",data:[]},{key:"math",name:"数学",data:[]},{key:"english",name:"英语",data:[]},{key:"two",name:"两科",data:[]},{key:"three",name:"三科",data:[]}]),w={types:[{description:"Excel",accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]}}],excludeAcceptAllOption:!0,multiple:!1};function y(){return window.showOpenFilePicker(w).then(([n])=>n.getFile()).then(n=>n.arrayBuffer()).then(n=>M.parse(n)).then(n=>{O.value=n;const o=n[0].data[0];k.value=[{title:"序号",dataIndex:"no",customRender:({index:r})=>`${r+1}`},...o.map(r=>({title:r,dataIndex:b[r]})),{title:"两科总分",dataIndex:"total"}],P.value=n.map(W)})}function I(){const n=O.value;s.value.forEach(p=>p.data=[]);let[o,r,i]=[[],[],[]],t={name:"校平",count:0,care:{chinese:0,math:0,total:0},score:{chinese:[],math:[],total:[]},chinese:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0},math:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0},english:{score:0,passCount:0,average:0,passRate:0},two:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0},three:{passCount:0,passRate:0}};for(let p=0;p<n.length;p++){const{data:u}=n[p];for(let g=0;g<u.length;g++){let[e,A,G,N,D,f,m]=u[g];m||(m=f),!(typeof N!="number"||typeof D!="number")&&(o.push(N),r.push(D),i.push(m))}}const C=(p,u)=>u-p,_=parseInt(.8*o.length);t.care.chinese=o.sort(C)[_],t.care.math=r.sort(C)[_],t.care.total=i.sort(C)[_],T.value=t.care;for(let p=0;p<n.length;p++){const{name:u,data:g}=n[p];let e={name:"",count:0,chinese:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0},math:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0},english:{score:0,passCount:0,average:0,passRate:0},two:{score:0,passCount:0,topCount:0,careCount:0,average:0,passRate:0,topRate:0,careRate:0},three:{passCount:0,passRate:0}};for(let A=0;A<g.length;A++){let[G,N,D,f,m,R,S]=g[A];S||(S=R,R=0),!(typeof f!="number"||typeof m!="number")&&(e.name=N,e.count++,e.two.score+=S,e.chinese.score+=f,e.math.score+=m,e.english.score+=R,f>=60&&(e.chinese.passCount++,f>=92.5&&e.chinese.topCount++,m>=60&&(e.two.passCount++,S>=185&&e.two.topCount++,R&&R>=60&&e.three.passCount++)),m>=60&&(e.math.passCount++,m>=92.5&&e.math.topCount++),R&&R>=60&&e.english.passCount++,f<=t.care.chinese&&e.chinese.careCount++,m<=t.care.math&&e.math.careCount++,S<=t.care.total&&e.two.careCount++)}t.count+=e.count,t.two.score+=e.two.score,t.two.passCount+=e.two.passCount,t.two.topCount+=e.two.topCount,t.two.careCount+=e.two.careCount,t.three.passCount+=e.three.passCount,t.chinese.score+=e.chinese.score,t.chinese.passCount+=e.chinese.passCount,t.chinese.topCount+=e.chinese.topCount,t.chinese.careCount+=e.chinese.careCount,t.math.score+=e.math.score,t.math.passCount+=e.math.passCount,t.math.topCount+=e.math.topCount,t.math.careCount+=e.math.careCount,t.english.score+=e.english.score,t.english.passCount+=e.english.passCount,e.two.average=a(e.two.score/e.count/2),e.two.passRate=a(e.two.passCount/e.count*100),e.two.careRate=a((1-e.two.careCount/e.count)*100),e.two.topRate=a(e.two.topCount/e.count*100),e.three.passRate=a(e.three.passCount/e.count*100),e.chinese.average=a(e.chinese.score/e.count),e.chinese.passRate=a(e.chinese.passCount/e.count*100),e.chinese.careRate=a((1-e.chinese.careCount/e.count)*100),e.chinese.topRate=a(e.chinese.topCount/e.count*100),e.math.average=a(e.math.score/e.count),e.math.passRate=a(e.math.passCount/e.count*100),e.math.careRate=a((1-e.math.careCount/e.count)*100),e.math.topRate=a(e.math.topCount/e.count*100),e.english.average=a(e.english.score/e.count),e.english.passRate=a(e.english.passCount/e.count*100),s.value[0].data.push({class:e.name,count:e.count,...e.chinese}),s.value[1].data.push({class:e.name,count:e.count,...e.math}),s.value[2].data.push({class:e.name,count:e.count,...e.english}),s.value[3].data.push({class:e.name,count:e.count,...e.two}),s.value[4].data.push({class:e.name,count:e.count,...e.three})}t.two.average=a(t.two.score/t.count/2),t.two.passRate=a(t.two.passCount/t.count*100),t.two.careRate=a((1-t.two.careCount/t.count)*100),t.two.topRate=a(t.two.topCount/t.count*100),t.three.passRate=a(t.three.passCount/t.count*100),t.chinese.average=a(t.chinese.score/t.count),t.chinese.passRate=a(t.chinese.passCount/t.count*100),t.chinese.careRate=a((1-t.chinese.careCount/t.count)*100),t.chinese.topRate=a(t.chinese.topCount/t.count*100),t.math.average=a(t.math.score/t.count),t.math.passRate=a(t.math.passCount/t.count*100),t.math.careRate=a((1-t.math.careCount/t.count)*100),t.math.topRate=a(t.math.topCount/t.count*100),t.english.average=a(t.english.score/t.count),t.english.passRate=a(t.english.passCount/t.count*100),s.value[0].data.push({class:t.name,count:t.count,...t.chinese}),s.value[1].data.push({class:t.name,count:t.count,...t.math}),s.value[2].data.push({class:t.name,count:t.count,...t.english}),s.value[3].data.push({class:t.name,count:t.count,...t.two}),s.value[4].data.push({class:t.name,count:t.count,...t.three})}function F(){const n=[];s.value.forEach(r=>{const i=[["班级","人数","平均分","及格人数","及格率","关爱人数","关爱率","特优人数","特优率"]];r.data.forEach(t=>i.push([t.class,t.count,t.average,t.passCount,t.passRate,t.careCount,t.careRate,t.topCount,t.topRate])),n.push({name:r.name,data:i})});const o=M.build(n);z(new File([o],"result.xlsx",{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}))}function W(n){const o={...n},r=n.data[0];return o.data.shift(),o.data=o.data.map(i=>{const t={};return i.forEach((C,_)=>t[b[r[_]]]=C),typeof t.chinese=="number"&&typeof t.math=="number"?t.total=t.chinese+t.math:t.total=t.chinese,i.push(t.total),t}),o}function a(n){return Math.round(n*100)/100}function z(n){const o=window.document.createElement("a");o.href=window.URL.createObjectURL(n),o.download=n.name,document.body.appendChild(o),o.click(),document.body.removeChild(o)}return{careScore:T,tableHead:k,tableData:P,resultHead:v,resultData:s,upload:y,analyse:I,download:F}}const ut={style:{width:"600px"}},rt={style:{width:"600px"}},xt={__name:"NormalAnalyze",setup(q){const{careScore:E,tableHead:j,tableData:L,resultHead:b,resultData:O,upload:k,analyse:P,download:T}=ct(),v=h(!1),s=h(null),w=h(null),y=h(null),I=h(0),F=[{title:"导入",description:"上传年级的成绩Excel文件。",target:()=>s.value&&s.value.$el},{title:"分析",description:"分析各个班级和全校的成绩指标。",target:()=>w.value&&w.value.$el},{title:"下载",description:"下载分析结果Excel文件。",target:()=>y.value&&y.value.$el}];return(W,a)=>{const z=Y,n=tt,o=et,r=at,i=ot,t=st,C=nt,_=K,p=X;return x(),H(U,null,[c(_,{gutter:[0,16]},{default:l(()=>[c(n,{span:24},{default:l(()=>[c(z,{banner:"",closable:"",message:"注意：本工具无后台服务，不会上传任何信息和文件，请放心使用。"})]),_:1}),c(n,{span:24},{default:l(()=>[c(r,{wrap:""},{default:l(()=>[c(o,{ref_key:"ref1",ref:s,type:"primary",onClick:a[0]||(a[0]=()=>d(k)())},{default:l(()=>[B("1. 导入")]),_:1},512),c(o,{ref_key:"ref2",ref:w,type:"primary",onClick:a[1]||(a[1]=()=>d(P)())},{default:l(()=>[B("2. 分析")]),_:1},512),c(o,{ref_key:"ref3",ref:y,type:"primary",onClick:a[2]||(a[2]=()=>d(T)())},{default:l(()=>[B("3. 下载")]),_:1},512),c(o,{type:"link",onClick:a[3]||(a[3]=()=>v.value=!0)},{default:l(()=>[B("帮助")]),_:1})]),_:1})]),_:1}),c(n,{span:12},{default:l(()=>[V("div",ut,[c(C,null,{default:l(()=>[(x(!0),H(U,null,Q(d(L),u=>(x(),Z(t,{key:u.name,tab:u.name},{default:l(()=>[c(i,{size:"small",pagination:!1,columns:d(j),dataSource:u.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])]),_:1}),c(n,{span:12},{default:l(()=>[V("div",rt,[V("div",null,"关爱分数：语文："+$(d(E).chinese)+" 数学："+$(d(E).math)+" 两科："+$(d(E).total),1),c(C,null,{default:l(()=>[(x(!0),H(U,null,Q(d(O),u=>(x(),Z(t,{key:u.key,tab:u.name},{default:l(()=>[c(i,{size:"small",pagination:!1,columns:d(b),dataSource:u.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])]),_:1})]),_:1}),c(p,J({current:I.value,"onUpdate:current":a[4]||(a[4]=u=>I.value=u)},{open:v.value,steps:F,onClose:()=>v.value=!1}),null,16,["current"])],64)}}};export{xt as default};
