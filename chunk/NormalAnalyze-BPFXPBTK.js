import{s as V}from"./node-xlsx-DLXZ95PR.js";import{d as D,e as q,f as G,g as J,h as K,B as X,S as Y,T as Z,i as tt,j as et,k as at}from"./ant-design-vue-BBdof-7I.js";import{r as d,P as I,U as j,c as u,R as i,V as nt,F as U,u as C,E as N,W as st,a0 as $,Q as L}from"./@vue-CnPkYVV3.js";import"./xlsx-BSlZAFvl.js";import"./@babel-D6Xak2o6.js";import"./@ant-design-xMf75DON.js";import"./@ctrl-DOFZgDuz.js";import"./dayjs-DfUUTG6R.js";import"./copy-to-clipboard-gvHgSpPc.js";import"./toggle-selection-BHUZwh74.js";import"./lodash-es-Bd9XdmsI.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./throttle-debounce-CUWDS_la.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./vue-types-C5fUfLeo.js";const[O,M,ot,lt]=[60,92.5,92.5*2,.2],A=["chinese","math","english","two","three"],W={年级:"grade",班级:"class",学生姓名:"name",语文:"chinese",数学:"math",英语:"english",两科总分:"two"};function b(m){return Math.round(m*100)/100}class Q{constructor(e){this.name=e||"",this.count=0,this.chinese=new z,this.math=new z,this.english=new z,this.two=new z,this.three=new z}plusCount(){this.count++}plus(e){A.forEach(l=>{this[l].plusScore(e[l].score),this[l].plusPassCount(e[l].passCount),this[l].plusTopCount(e[l].topCount)})}calc(){A.forEach(e=>{this[e].calc(this.count)}),this.two.average=b(this.two.average/2),this.three.average=b(this.three.average/3)}}class z{constructor(){this.score=0,this.passCount=0,this.topCount=0,this.careScore=0,this.average=0,this.passRate=0,this.topRate=0,this.careStu=[]}plusScore(e){this.score+=e}plusPassCount(e){this.passCount+=e===void 0?1:e}plusTopCount(e){this.topCount+=e===void 0?1:e}pushCareStu(e){this.careStu.push(e)}calc(e){this.calcCareScore(),this.average=b(this.score/e),this.passRate=b(this.passCount/e*100),this.topRate=b(this.topCount/e*100)}calcCareScore(){if(this.careStu.length===0)return;this.careStu=this.careStu.sort((l,S)=>l[3]-S[3]).slice(0,Math.round(this.careStu.length*lt));let e=0;for(let l=0;l<this.careStu.length;l++)e+=this.careStu[l][3];this.careScore=b(e/this.careStu.length)}}function ut(){const m=d(!1),e=d([]),l=d([]),S=d([]),B=d([{title:"班级",dataIndex:"class"},{title:"人数",dataIndex:"count"},{title:"平均分",dataIndex:"average"},{title:"及格人数",dataIndex:"passCount"},{title:"及格率",dataIndex:"passRate"},{title:"关爱平均分",dataIndex:"careScore"},{title:"特优人数",dataIndex:"topCount"},{title:"特优率",dataIndex:"topRate"}]),w=d([{key:"chinese",name:"语文",data:[]},{key:"math",name:"数学",data:[]},{key:"english",name:"英语",data:[]},{key:"two",name:"两科",data:[]},{key:"three",name:"三科",data:[]}]),k=d([{key:"chinese",name:"语文关爱生",data:[]},{key:"math",name:"数学关爱生",data:[]},{key:"english",name:"英语关爱生",data:[]},{key:"two",name:"两科关爱生",data:[]}]),F={types:[{description:"Excel",accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]}}],excludeAcceptAllOption:!0,multiple:!1};function H(){return window.showOpenFilePicker(F).then(([n])=>n.getFile()).then(n=>n.arrayBuffer()).then(n=>V.parse(n)).then(n=>x(n))}function x(n){e.value=n;const s=n[0].data[0];s.length!==5&&s.length!==6&&(console.error(s),D.error("成绩数据格式错误！")),l.value=[{title:"序号",dataIndex:"no",customRender:({index:a})=>`${a+1}`},...s.map(a=>({title:a,dataIndex:W[a]})),{title:"两科总分",dataIndex:"two"}],S.value=n.map(E),m.value=!1}function E(n){const s={...n},a=n.data[0];return s.data.shift(),s.data=s.data.map(r=>{const t={};return r.forEach((o,p)=>t[W[a[p]]]=o),typeof t.chinese=="number"&&typeof t.math=="number"?t.two=t.chinese+t.math:t.two=t.chinese,r.push(t.two),t}),s}function R(){if(m.value){D.warn("已经分析完成，请下载结果！");return}if(e.value.length===0){D.warn("请先上传成绩文件！");return}const n=e.value;w.value.forEach(a=>a.data=[]),k.value.forEach(a=>a.data=[]);const s=new Q("校平");for(let a=0;a<n.length;a++){const{data:r}=n[a],t=new Q;for(let o=0;o<r.length;o++){let[p,f,v,_,g,...y]=r[o];if(typeof _!="number"||typeof g!="number")continue;let h,c;y.length===1?[h,c]=[0,y[0]]:y.length===2&&([h,c]=y),t.name=f,t.plusCount(),t.chinese.plusScore(_),t.math.plusScore(g),t.english.plusScore(h),t.two.plusScore(c),_>=O&&(t.chinese.plusPassCount(),_>=M&&t.chinese.plusTopCount(),g>=O&&(t.two.plusPassCount(),c>=ot&&t.two.plusTopCount(),h&&h>=O&&t.three.plusPassCount())),g>=O&&(t.math.plusPassCount(),g>=M&&t.math.plusTopCount()),h&&h>=O&&t.english.plusPassCount(),t.chinese.pushCareStu([p,f,v,_]),t.math.pushCareStu([p,f,v,g]),h&&t.english.pushCareStu([p,f,v,h]),t.two.pushCareStu([p,f,v,c]),s.plusCount()}s.plus(t),t.calc(),A.forEach((o,p)=>{w.value[p].data.push({class:t.name,count:t.count,...t[o]}),p<4&&k.value[p].data.push(...t[o].careStu)})}s.calc(),A.forEach((a,r)=>{w.value[r].data.unshift({class:s.name,count:s.count,...s[a]})}),m.value=!0}function P(){const n=[];w.value.forEach(r=>{const t=[B.value.map(o=>o.title)];r.data.forEach(o=>t.push([o.class,o.count,o.average,o.passCount,o.passRate,o.careScore,o.topCount,o.topRate])),n.push({name:r.name,data:t})});const s=["语文","数学","英语","两科"];k.value.forEach((r,t)=>{const o=["年级","班级","姓名",s[t]];n.push({name:s[t]+"关爱生",data:[o,...r.data]})});const a=V.build(n);T(new File([a],"result.xlsx",{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}))}function T(n){const s=window.document.createElement("a");s.href=window.URL.createObjectURL(n),s.download=n.name,document.body.appendChild(s),s.click(),document.body.removeChild(s)}return{done:m,tableHead:l,tableData:S,resultHead:B,resultData:w,upload:H,analyse:R,download:P}}const rt={style:{width:"800px"}},Tt={__name:"NormalAnalyze",setup(m){const{done:e,tableHead:l,tableData:S,resultHead:B,resultData:w,upload:k,analyse:F,download:H}=ut(),x=d(!1),E=d(null),R=d(null),P=d(null),T=d(0),n=[{title:"导入",description:"上传年级的成绩Excel文件。",target:()=>E.value&&E.value.$el},{title:"分析",description:"分析各个班级和全校的成绩指标。",target:()=>R.value&&R.value.$el},{title:"下载",description:"下载分析结果Excel文件。",target:()=>P.value&&P.value.$el}];return(s,a)=>{const r=J,t=K,o=X,p=Y,f=et,v=at,_=Z,g=tt,y=q,h=G;return I(),j(U,null,[u(y,{gutter:[0,16]},{default:i(()=>[u(t,{span:24},{default:i(()=>[u(r,{banner:"",closable:"",message:"注意：本工具无后台服务，不会上传任何信息和文件，请放心使用。最近更新：新增关爱平均分"})]),_:1}),u(t,{span:24},{default:i(()=>[u(p,{wrap:""},{default:i(()=>[u(o,{ref_key:"ref1",ref:E,type:"primary",onClick:a[0]||(a[0]=()=>C(k)())},{default:i(()=>[N("1. 导入")]),_:1},512),u(o,{ref_key:"ref2",ref:R,type:"primary",onClick:a[1]||(a[1]=()=>C(F)())},{default:i(()=>[N("2. 分析")]),_:1},512),u(o,{ref_key:"ref3",ref:P,type:"primary",onClick:a[2]||(a[2]=()=>C(H)())},{default:i(()=>[N("3. 下载")]),_:1},512),u(o,{type:"link",onClick:a[3]||(a[3]=()=>{x.value=!0,T.value=0})},{default:i(()=>[N("帮助")]),_:1})]),_:1})]),_:1}),u(t,{span:24},{default:i(()=>[st("div",rt,[u(_,null,{default:i(()=>[(I(!0),j(U,null,$(C(S),c=>(I(),L(v,{key:c.name,tab:c.name},{default:i(()=>[u(f,{size:"small",pagination:!1,columns:C(l),dataSource:c.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])]),_:1}),u(g,{open:C(e),size:"large",title:"成绩分析结果",onClose:a[4]||(a[4]=()=>e.value=!1)},{default:i(()=>[u(r,{banner:"",closable:"",type:"success",message:"注意：更多详细分析结果点击下载。"}),u(_,null,{default:i(()=>[(I(!0),j(U,null,$(C(w),c=>(I(),L(v,{key:c.key,tab:c.name},{default:i(()=>[u(f,{size:"small",pagination:!1,columns:C(B),dataSource:c.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})]),_:1},8,["open"])]),_:1}),u(h,nt({current:T.value,"onUpdate:current":a[5]||(a[5]=c=>T.value=c)},{open:x.value,steps:n,onClose:()=>x.value=!1}),null,16,["current"])],64)}}};export{Tt as default};
