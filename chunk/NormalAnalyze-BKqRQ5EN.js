import{s as q}from"./node-xlsx-DLXZ95PR.js";import{d as U,e as X,f as Y,g as Z,h as ee,B as te,S as ae,T as ne,i as oe,j as se,k as ce}from"./ant-design-vue-BBdof-7I.js";import{r as h,P as x,U as V,c as r,R as i,V as ue,F as $,u as f,E as z,W as re,a0 as G,Q as J}from"./@vue-CnPkYVV3.js";import"./xlsx-BSlZAFvl.js";import"./@babel-D6Xak2o6.js";import"./@ant-design-xMf75DON.js";import"./@ctrl-DOFZgDuz.js";import"./dayjs-DfUUTG6R.js";import"./copy-to-clipboard-gvHgSpPc.js";import"./toggle-selection-BHUZwh74.js";import"./lodash-es-Bd9XdmsI.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./throttle-debounce-CUWDS_la.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./vue-types-C5fUfLeo.js";function le(){const O={年级:"grade",班级:"class",学生姓名:"name",语文:"chinese",数学:"math",英语:"english",两科总分:"total"},C=h(!1),S=h([]),P=h([]),T=h([]),v=h([{title:"班级",dataIndex:"class"},{title:"人数",dataIndex:"count"},{title:"平均分",dataIndex:"average"},{title:"及格人数",dataIndex:"passCount"},{title:"及格率",dataIndex:"passRate"},{title:"关爱平均分",dataIndex:"careScore"},{title:"特优人数",dataIndex:"topCount"},{title:"特优率",dataIndex:"topRate"}]),c=h([{key:"chinese",name:"语文",data:[]},{key:"math",name:"数学",data:[]},{key:"english",name:"英语",data:[]},{key:"two",name:"两科",data:[]},{key:"three",name:"三科",data:[]}]),m=h([{key:"chinese",name:"语文关爱生",data:[]},{key:"math",name:"数学关爱生",data:[]},{key:"english",name:"英语关爱生",data:[]},{key:"two",name:"两科关爱生",data:[]}]),R={types:[{description:"Excel",accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]}}],excludeAcceptAllOption:!0,multiple:!1};function w(){return window.showOpenFilePicker(R).then(([a])=>a.getFile()).then(a=>a.arrayBuffer()).then(a=>q.parse(a)).then(a=>F(a))}function F(a){S.value=a;const t=a[0].data[0];t.length!==5&&t.length!==6&&(console.error(t),U.error("成绩数据格式错误！")),P.value=[{title:"序号",dataIndex:"no",customRender:({index:o})=>`${o+1}`},...t.map(o=>({title:o,dataIndex:O[o]})),{title:"两科总分",dataIndex:"total"}],T.value=a.map(W),C.value=!1}function W(a){const t={...a},o=a.data[0];return t.data.shift(),t.data=t.data.map(s=>{const e={};return s.forEach((u,p)=>e[O[o[p]]]=u),typeof e.chinese=="number"&&typeof e.math=="number"?e.total=e.chinese+e.math:e.total=e.chinese,s.push(e.total),e}),t}function l(){if(C.value){U.warn("已经分析完成，请下载结果！");return}if(S.value.length===0){U.warn("请先上传成绩文件！");return}const a=S.value;c.value.forEach(o=>o.data=[]),m.value.forEach(o=>o.data=[]);let t={name:"校平",count:0,chinese:{score:0,passCount:0,topCount:0,average:0,passRate:0,topRate:0},math:{score:0,passCount:0,topCount:0,average:0,passRate:0,topRate:0},english:{score:0,passCount:0,average:0,passRate:0},two:{score:0,passCount:0,topCount:0,average:0,passRate:0,topRate:0},three:{passCount:0,passRate:0}};for(let o=0;o<a.length;o++){const{data:s}=a[o];let e={name:"",count:0,chinese:{score:0,passCount:0,topCount:0,careScore:0,average:0,passRate:0,topRate:0,careStu:[]},math:{score:0,passCount:0,topCount:0,careScore:0,average:0,passRate:0,topRate:0,careStu:[]},english:{score:0,passCount:0,careScore:0,average:0,passRate:0,careStu:[]},two:{score:0,passCount:0,topCount:0,careScore:0,average:0,passRate:0,topRate:0,careStu:[]},three:{passCount:0,passRate:0}};for(let D=0;D<s.length;D++){let[A,E,I,b,g,...N]=s[D];if(typeof b!="number"||typeof g!="number")continue;let d,k;N.length===1?[d,k]=[0,N[0]]:N.length===2&&([d,k]=N),e.name=E,e.count++,e.chinese.score+=b,e.math.score+=g,e.english.score+=d,e.two.score+=k,b>=60&&(e.chinese.passCount++,b>=92.5&&e.chinese.topCount++,g>=60&&(e.two.passCount++,k>=185&&e.two.topCount++,d&&d>=60&&e.three.passCount++)),g>=60&&(e.math.passCount++,g>=92.5&&e.math.topCount++),d&&d>=60&&e.english.passCount++,e.chinese.careStu.push([A,E,I,b]),e.math.careStu.push([A,E,I,g]),d&&e.english.careStu.push([A,E,I,d]),e.two.careStu.push([A,E,I,k]),t.count++}const u=_(e.chinese.careStu),p=_(e.math.careStu),M=_(e.english.careStu),Q=_(e.two.careStu);t.two.score+=e.two.score,t.two.passCount+=e.two.passCount,t.two.topCount+=e.two.topCount,t.three.passCount+=e.three.passCount,t.chinese.score+=e.chinese.score,t.chinese.passCount+=e.chinese.passCount,t.chinese.topCount+=e.chinese.topCount,t.math.score+=e.math.score,t.math.passCount+=e.math.passCount,t.math.topCount+=e.math.topCount,t.english.score+=e.english.score,t.english.passCount+=e.english.passCount,e.two.average=n(e.two.score/e.count/2),e.two.passRate=n(e.two.passCount/e.count*100),e.two.topRate=n(e.two.topCount/e.count*100),e.two.careScore=Q.careScore,e.three.passRate=n(e.three.passCount/e.count*100),e.chinese.average=n(e.chinese.score/e.count),e.chinese.passRate=n(e.chinese.passCount/e.count*100),e.chinese.topRate=n(e.chinese.topCount/e.count*100),e.chinese.careScore=u.careScore,e.math.average=n(e.math.score/e.count),e.math.passRate=n(e.math.passCount/e.count*100),e.math.topRate=n(e.math.topCount/e.count*100),e.math.careScore=p.careScore,e.english.average=n(e.english.score/e.count),e.english.passRate=n(e.english.passCount/e.count*100),e.english.careScore=M.careScore,c.value[0].data.push({class:e.name,count:e.count,...e.chinese}),c.value[1].data.push({class:e.name,count:e.count,...e.math}),c.value[2].data.push({class:e.name,count:e.count,...e.english}),c.value[3].data.push({class:e.name,count:e.count,...e.two}),c.value[4].data.push({class:e.name,count:e.count,...e.three}),m.value[0].data.push(...u.careStu),m.value[1].data.push(...p.careStu),m.value[2].data.push(...M.careStu),m.value[3].data.push(...Q.careStu)}t.two.average=n(t.two.score/t.count/2),t.two.passRate=n(t.two.passCount/t.count*100),t.two.topRate=n(t.two.topCount/t.count*100),t.three.passRate=n(t.three.passCount/t.count*100),t.chinese.average=n(t.chinese.score/t.count),t.chinese.passRate=n(t.chinese.passCount/t.count*100),t.chinese.topRate=n(t.chinese.topCount/t.count*100),t.math.average=n(t.math.score/t.count),t.math.passRate=n(t.math.passCount/t.count*100),t.math.topRate=n(t.math.topCount/t.count*100),t.english.average=n(t.english.score/t.count),t.english.passRate=n(t.english.passCount/t.count*100),c.value[0].data.unshift({class:t.name,count:t.count,...t.chinese}),c.value[1].data.unshift({class:t.name,count:t.count,...t.math}),c.value[2].data.unshift({class:t.name,count:t.count,...t.english}),c.value[3].data.unshift({class:t.name,count:t.count,...t.two}),c.value[4].data.unshift({class:t.name,count:t.count,...t.three}),C.value=!0}function _(a){if(a.length===0)return{careStu:[],careScore:0};a=a.filter(s=>typeof s[3]=="number").sort((s,e)=>s[3]-e[3]);const t=a.slice(0,Math.round(a.length*.2));let o=0;for(let s=0;s<t.length;s++)o+=t[s][3];return{careStu:t,careScore:n(o/t.length)}}function y(){const a=[];c.value.forEach(s=>{const e=[["班级","人数","平均分","及格人数","及格率","关爱平均分","特优人数","特优率"]];s.data.forEach(u=>e.push([u.class,u.count,u.average,u.passCount,u.passRate,u.careScore,u.topCount,u.topRate])),a.push({name:s.name,data:e})});const t=["语文","数学","英语","两科"];m.value.forEach((s,e)=>{const u=["年级","班级","姓名",t[e]];a.push({name:t[e]+"关爱生",data:[u,...s.data]})});const o=q.build(a);H(new File([o],"result.xlsx",{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}))}function n(a){return Math.round(a*100)/100}function H(a){const t=window.document.createElement("a");t.href=window.URL.createObjectURL(a),t.download=a.name,document.body.appendChild(t),t.click(),document.body.removeChild(t)}return{done:C,tableHead:P,tableData:T,resultHead:v,resultData:c,upload:w,analyse:l,download:y}}const pe={style:{width:"800px"}},Ae={__name:"NormalAnalyze",setup(K){const{done:B,tableHead:j,tableData:L,resultHead:O,resultData:C,upload:S,analyse:P,download:T}=le(),v=h(!1),c=h(null),m=h(null),R=h(null),w=h(0),F=[{title:"导入",description:"上传年级的成绩Excel文件。",target:()=>c.value&&c.value.$el},{title:"分析",description:"分析各个班级和全校的成绩指标。",target:()=>m.value&&m.value.$el},{title:"下载",description:"下载分析结果Excel文件。",target:()=>R.value&&R.value.$el}];return(W,l)=>{const _=Z,y=ee,n=te,H=ae,a=se,t=ce,o=ne,s=oe,e=X,u=Y;return x(),V($,null,[r(e,{gutter:[0,16]},{default:i(()=>[r(y,{span:24},{default:i(()=>[r(_,{banner:"",closable:"",message:"注意：本工具无后台服务，不会上传任何信息和文件，请放心使用。最近更新：新增关爱平均分"})]),_:1}),r(y,{span:24},{default:i(()=>[r(H,{wrap:""},{default:i(()=>[r(n,{ref_key:"ref1",ref:c,type:"primary",onClick:l[0]||(l[0]=()=>f(S)())},{default:i(()=>[z("1. 导入")]),_:1},512),r(n,{ref_key:"ref2",ref:m,type:"primary",onClick:l[1]||(l[1]=()=>f(P)())},{default:i(()=>[z("2. 分析")]),_:1},512),r(n,{ref_key:"ref3",ref:R,type:"primary",onClick:l[2]||(l[2]=()=>f(T)())},{default:i(()=>[z("3. 下载")]),_:1},512),r(n,{type:"link",onClick:l[3]||(l[3]=()=>{v.value=!0,w.value=0})},{default:i(()=>[z("帮助")]),_:1})]),_:1})]),_:1}),r(y,{span:24},{default:i(()=>[re("div",pe,[r(o,null,{default:i(()=>[(x(!0),V($,null,G(f(L),p=>(x(),J(t,{key:p.name,tab:p.name},{default:i(()=>[r(a,{size:"small",pagination:!1,columns:f(j),dataSource:p.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])]),_:1}),r(s,{open:f(B),size:"large",title:"成绩分析结果",onClose:l[4]||(l[4]=()=>B.value=!1)},{default:i(()=>[r(_,{banner:"",closable:"",type:"success",message:"注意：更多详细分析结果点击下载。"}),r(o,null,{default:i(()=>[(x(!0),V($,null,G(f(C),p=>(x(),J(t,{key:p.key,tab:p.name},{default:i(()=>[r(a,{size:"small",pagination:!1,columns:f(O),dataSource:p.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})]),_:1},8,["open"])]),_:1}),r(u,ue({current:w.value,"onUpdate:current":l[5]||(l[5]=p=>w.value=p)},{open:v.value,steps:F,onClose:()=>v.value=!1}),null,16,["current"])],64)}}};export{Ae as default};
