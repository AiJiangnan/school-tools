import{r as G,u as k,w as Q}from"./xlsx-DZ7xr1Uj.js";import{d as H,e as U,f as q,g as J,h as K,i as Y,B as Z,S as tt,T as et,j as at,k as nt,P as st,I as ot,m as lt,n as ut,o as rt}from"./ant-design-vue-DIteRdMU.js";import{r as x,Q as R,U as z,c as a,S as s,u as S,F,G as c,W as ct,a0 as M,R as V}from"./@vue-BC2K3yCp.js";import"./@babel-BiFW4_mA.js";import"./@ant-design-BZl7eYef.js";import"./@ctrl-DOFZgDuz.js";import"./dayjs-DnHGOLEN.js";import"./copy-to-clipboard-gvHgSpPc.js";import"./toggle-selection-BHUZwh74.js";import"./lodash-es-BdFaghAI.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./throttle-debounce-CUWDS_la.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./vue-types-C5fUfLeo.js";const[T,L,pt,it]=[60,92.5,92.5*2,.2],O=["chinese","math","english","two","three"];function b(m){return Math.round(m*100)/100}class W{constructor(n){this.name=n||"",this.count=0,this.chinese=new P,this.math=new P,this.english=new P,this.two=new P,this.three=new P}plusCount(){this.count++}plus(n){O.forEach(r=>{this[r].plusScore(n[r].score),this[r].plusPassCount(n[r].passCount),this[r].plusTopCount(n[r].topCount)})}calc(){O.forEach(n=>{this[n].calc(this.count)}),this.two.average=b(this.two.average/2),this.three.average=b(this.three.average/3)}}class P{constructor(){this.score=0,this.passCount=0,this.topCount=0,this.careScore=0,this.average=0,this.passRate=0,this.topRate=0,this.careStu=[]}plusScore(n){this.score+=n}plusPassCount(n){this.passCount+=n===void 0?1:n}plusTopCount(n){this.topCount+=n===void 0?1:n}pushCareStu(n){this.careStu.push(n)}calc(n){this.calcCareScore(),this.average=b(this.score/n),this.passRate=b(this.passCount/n*100),this.topRate=b(this.topCount/n*100)}calcCareScore(){if(this.careStu.length===0)return;this.careStu=this.careStu.sort((r,v)=>r[3]-v[3]).slice(0,Math.round(this.careStu.length*it));let n=0;for(let r=0;r<this.careStu.length;r++)n+=this.careStu[r][3];this.careScore=b(n/this.careStu.length)}}function dt(){const m=x(!1),n=x([]),r=x([{title:"序号",dataIndex:"no",customRender:({index:t})=>`${t+1}`},{title:"年级",dataIndex:"grade"},{title:"班级",dataIndex:"class"},{title:"学生姓名",dataIndex:"name"},{title:"语文",dataIndex:"chinese",sorter:(t,o)=>t.chinese-o.chinese},{title:"数学",dataIndex:"math",sorter:(t,o)=>t.math-o.math},{title:"英语",dataIndex:"english",sorter:(t,o)=>t.english-o.english},{title:"两科总分",dataIndex:"two",sorter:(t,o)=>t.two-o.two}]),v=x([{title:"班级",dataIndex:"class"},{title:"人数",dataIndex:"count"},{title:"平均分",dataIndex:"average"},{title:"及格人数",dataIndex:"passCount"},{title:"及格率",dataIndex:"passRate"},{title:"关爱平均分",dataIndex:"careScore"},{title:"特优人数",dataIndex:"topCount"},{title:"特优率",dataIndex:"topRate"}]),y=x([{key:"chinese",name:"语文",data:[]},{key:"math",name:"数学",data:[]},{key:"english",name:"英语",data:[]},{key:"two",name:"两科",data:[]},{key:"three",name:"三科",data:[]}]),I=x([{key:"chinese",name:"语文关爱生",data:[]},{key:"math",name:"数学关爱生",data:[]},{key:"english",name:"英语关爱生",data:[]},{key:"two",name:"两科关爱生",data:[]}]),B={types:[{description:"Excel",accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]}}],excludeAcceptAllOption:!0,multiple:!1};function N(){return window.showOpenFilePicker(B).then(([t])=>t.getFile()).then(t=>t.arrayBuffer()).then(t=>G(t)).then(t=>j(t))}function j(t){n.value=t.SheetNames.map(o=>{const u=k.sheet_to_json(t.Sheets[o]).map(({年级:e,班级:_,学生姓名:p,语文:i,数学:f,英语:C})=>{const d=typeof i=="number"&&typeof f=="number"?i+f:i;return{grade:e,class:_,name:p,chinese:i,math:f,english:C,two:d}});return{sheet:o,data:u}}),m.value=!1}function E(){if(m.value){H.warn("已经分析完成，请下载结果！");return}if(n.value.length===0){H.warn("请先上传成绩文件！");return}y.value.forEach(l=>l.data=[]),I.value.forEach(l=>l.data=[]);const t=new W("校平"),o=n.value;for(let l=0;l<o.length;l++){const{data:u}=o[l],e=new W;for(let _=0;_<u.length;_++){let{grade:p,class:i,name:f,chinese:C,math:d,english:h,two:g}=u[_];h=h||0,!(typeof C!="number"||typeof d!="number")&&(e.name=i,e.plusCount(),e.chinese.plusScore(C),e.math.plusScore(d),e.english.plusScore(h),e.two.plusScore(g),C>=T&&(e.chinese.plusPassCount(),C>=L&&e.chinese.plusTopCount(),d>=T&&(e.two.plusPassCount(),g>=pt&&e.two.plusTopCount(),h&&h>=T&&e.three.plusPassCount())),d>=T&&(e.math.plusPassCount(),d>=L&&e.math.plusTopCount()),h&&h>=T&&e.english.plusPassCount(),e.chinese.pushCareStu([p,i,f,C]),e.math.pushCareStu([p,i,f,d]),h&&e.english.pushCareStu([p,i,f,h]),e.two.pushCareStu([p,i,f,g]),t.plusCount())}t.plus(e),e.calc(),O.forEach((_,p)=>{y.value[p].data.push({class:e.name,count:e.count,...e[_]}),p<4&&I.value[p].data.push(...e[_].careStu)})}t.calc(),O.forEach((l,u)=>{y.value[u].data.unshift({class:t.name,count:t.count,...t[l]})}),m.value=!0}function D(){if(!m.value){H.warning("请先分析成绩！");return}const t=k.book_new();y.value.forEach(l=>{const u=[v.value.map(e=>e.title)];l.data.forEach(e=>u.push([e.class,e.count,e.average,e.passCount,e.passRate,e.careScore,e.topCount,e.topRate])),k.book_append_sheet(t,k.aoa_to_sheet(u),l.name)});const o=["语文","数学","英语","两科"];I.value.forEach((l,u)=>{const e=[["年级","班级","姓名",o[u]],...l.data];k.book_append_sheet(t,k.aoa_to_sheet(e),`${o[u]}关爱生`)}),Q(t,"result.xlsx")}return{done:m,tableHead:r,excelData:n,resultHead:v,resultData:y,upload:N,analyse:E,download:D}}const ht={style:{width:"800px"}},Nt={__name:"NormalAnalyze",setup(m){const{done:n,tableHead:r,excelData:v,resultHead:y,resultData:I,upload:B,analyse:N,download:j}=dt(),E=x(!1);return(D,t)=>{const o=K,l=Y,u=Z,e=tt,_=ut,p=rt,i=et,f=U,C=q,d=at,h=nt,g=st,A=ot,X=lt,$=J;return R(),z(F,null,[a(f,{gutter:[0,16]},{default:s(()=>[a(l,{span:24},{default:s(()=>[a(o,{banner:"",closable:"",message:"注意：本工具无后台服务，不会上传任何信息和文件，请放心使用。最近更新：新增关爱平均分"})]),_:1}),a(l,{span:24},{default:s(()=>[a(e,{wrap:""},{default:s(()=>[a(u,{ref:"ref1",type:"primary",onClick:t[0]||(t[0]=()=>S(B)())},{default:s(()=>[c("1. 导入")]),_:1},512),a(u,{ref:"ref2",type:"primary",onClick:t[1]||(t[1]=()=>S(N)())},{default:s(()=>[c("2. 分析")]),_:1},512),a(u,{type:"link",onClick:t[2]||(t[2]=()=>{E.value=!0})},{default:s(()=>[c("帮助")]),_:1})]),_:1})]),_:1}),a(l,{span:24},{default:s(()=>[ct("div",ht,[a(i,null,{default:s(()=>[(R(!0),z(F,null,M(S(v),w=>(R(),V(p,{key:w.sheet,tab:w.sheet},{default:s(()=>[a(_,{size:"small",pagination:!1,columns:S(r),dataSource:w.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})])]),_:1})]),_:1}),a(C,{open:S(n),size:"large",title:"成绩分析结果",onClose:t[4]||(t[4]=()=>n.value=!1)},{extra:s(()=>[a(u,{ref:"ref3",type:"primary",onClick:t[3]||(t[3]=()=>S(j)())},{default:s(()=>[c("3. 下载")]),_:1},512)]),default:s(()=>[a(o,{banner:"",closable:"",type:"success",message:"注意：更多详细分析结果点击下载。"}),a(i,null,{default:s(()=>[(R(!0),z(F,null,M(S(I),w=>(R(),V(p,{key:w.key,tab:w.name},{default:s(()=>[a(_,{size:"small",pagination:!1,columns:S(y),dataSource:w.data},null,8,["columns","dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})]),_:1},8,["open"]),a($,{open:E.value,width:"800px",footer:null,onCancel:t[5]||(t[5]=()=>E.value=!1)},{default:s(()=>[a(X,null,{default:s(()=>[a(d,{level:2},{default:s(()=>[c("帮助文档")]),_:1}),a(d,{level:3},{default:s(()=>[c("1. 导入")]),_:1}),a(g,null,{default:s(()=>[c(" 第一步：点击导入按钮，导入各班级成绩的Excel文档，文件格式必须为"),a(h,{strong:"",type:"danger"},{default:s(()=>[c(" .xlsx ")]),_:1}),c("，数据表格必须包含列： ")]),_:1}),a(g,null,{default:s(()=>[a(h,{strong:"",type:"danger"},{default:s(()=>[c("年级、班级、学生姓名、语文、数学、英语（可选）")]),_:1})]),_:1}),a(g,null,{default:s(()=>[c(" 不计排名规则：只有当语文、数学其中一个成绩不为数字时，不会计入统计中；如果语文、数学都有成绩，英语没有成绩时，会计算错误，当存在这种情况时，需要确定成绩是否计入排名。 ")]),_:1}),a(g,null,{default:s(()=>[c(" 导入成绩后，可以通过切换标签页，查看各个班级的各科成绩情况，并且支持对各科进行排序。 ")]),_:1}),a(A,{src:"/1.png"}),a(d,{level:3},{default:s(()=>[c("2. 分析")]),_:1}),a(g,null,{default:s(()=>[c(" 第二步：点击分析按钮，分析班级各个指标，结果弹窗展示，切换标签页面查看每个班级的情况。 ")]),_:1}),a(A,{src:"/2.png"}),a(d,{level:3},{default:s(()=>[c("3. 下载")]),_:1}),a(g,null,{default:s(()=>[c(" 第三步：点击下载按钮，下载各个班级详情的分析结果，包含各个班级的各个指标，以及关爱学生名单。 ")]),_:1}),a(A,{src:"/3.png"})]),_:1})]),_:1},8,["open"])],64)}}};export{Nt as default};
